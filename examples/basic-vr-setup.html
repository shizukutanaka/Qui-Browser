<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic VR Setup - Qui Browser VR Example</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            overflow: hidden;
        }

        #container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
        }

        h1 {
            margin: 0 0 10px 0;
            font-size: 24px;
            color: #00ffff;
        }

        p {
            margin: 5px 0;
            font-size: 14px;
            line-height: 1.6;
        }

        #vr-button {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            padding: 20px 40px;
            background: linear-gradient(135deg, #00ffff 0%, #0099ff 100%);
            color: #000;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.3);
        }

        #vr-button:hover {
            transform: translateX(-50%) translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 255, 255, 0.5);
        }

        #vr-button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        #status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            opacity: 0.3;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div id="container"></div>

    <div id="info">
        <h1>Basic VR Setup Example</h1>
        <p>ã“ã®ãƒšãƒ¼ã‚¸ã¯ã€Qui Browser VRã®åŸºæœ¬çš„ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¾‹ã§ã™ã€‚</p>
        <p><strong>æ©Ÿèƒ½:</strong></p>
        <ul style="margin: 10px 0; padding-left: 20px; font-size: 14px;">
            <li>VRã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</li>
            <li>ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°</li>
            <li>ã‚¨ãƒ«ã‚´ãƒãƒŸã‚¯ã‚¹UI</li>
            <li>å¿«é©æ€§ã‚·ã‚¹ãƒ†ãƒ </li>
            <li>å…¥åŠ›æœ€é©åŒ–</li>
        </ul>
        <div class="code-block">
            // VRãƒ¢ãƒ¼ãƒ‰ã‚’èµ·å‹•ã™ã‚‹ã«ã¯<br>
            // ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
        </div>
    </div>

    <div id="status">ğŸ®</div>

    <button id="vr-button">VRãƒ¢ãƒ¼ãƒ‰èµ·å‹•</button>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

    <!-- VR Modules -->
    <script src="../assets/js/vr-utils.js"></script>
    <script src="../assets/js/vr-launcher.js"></script>
    <script src="../assets/js/vr-text-renderer.js"></script>
    <script src="../assets/js/vr-ergonomic-ui.js"></script>
    <script src="../assets/js/vr-comfort-system.js"></script>
    <script src="../assets/js/vr-input-optimizer.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let scene, camera, renderer;
        let vrLauncher, textRenderer, ergoUI, comfortSystem, inputOptimizer;
        let clock;
        let isVRActive = false;

        // åˆæœŸåŒ–
        function init() {
            console.log('Initializing Basic VR Setup...');

            // Three.jsã‚·ãƒ¼ãƒ³ä½œæˆ
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);

            // ã‚«ãƒ¡ãƒ©ä½œæˆ
            camera = new THREE.PerspectiveCamera(
                90,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(0, 1.6, 0); // æ¨™æº–çš„ãªç›®ã®é«˜ã•

            // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ä½œæˆ
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.xr.enabled = true;
            document.getElementById('container').appendChild(renderer.domElement);

            // ã‚¯ãƒ­ãƒƒã‚¯
            clock = new THREE.Clock();

            // VRã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
            initVRSystems();

            // ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¿½åŠ 
            addSampleContent();

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            setupEventListeners();

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—é–‹å§‹
            renderer.setAnimationLoop(animate);

            console.log('Basic VR Setup initialized successfully!');
        }

        // VRã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        function initVRSystems() {
            // VRãƒ©ãƒ³ãƒãƒ£ãƒ¼
            vrLauncher = new VRLauncher();

            // ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
            textRenderer = new VRTextRenderer();

            // ã‚¨ãƒ«ã‚´ãƒãƒŸã‚¯ã‚¹UI
            ergoUI = new VRErgonomicUI();
            ergoUI.init(camera, scene);

            // å¿«é©æ€§ã‚·ã‚¹ãƒ†ãƒ 
            comfortSystem = new VRComfortSystem();
            comfortSystem.init(scene, camera);

            // å…¥åŠ›æœ€é©åŒ–
            inputOptimizer = new VRInputOptimizer();
            inputOptimizer.init(camera, scene, renderer, {
                mode: 'hybrid',
                dwellTime: 1000,
                enableHaptics: true
            });

            console.log('VR systems initialized');
        }

        // ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¿½åŠ 
        function addSampleContent() {
            // åºŠã‚°ãƒªãƒƒãƒ‰
            const gridHelper = new THREE.GridHelper(20, 20, 0x00ffff, 0x444444);
            scene.add(gridHelper);

            // ç’°å¢ƒå…‰
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            // ãƒã‚¤ãƒ³ãƒˆãƒ©ã‚¤ãƒˆ
            const pointLight = new THREE.PointLight(0x00ffff, 1, 100);
            pointLight.position.set(0, 5, 0);
            scene.add(pointLight);

            // ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ3Dã‚¹ãƒ—ãƒ©ã‚¤ãƒˆï¼‰
            const welcomeSprite = textRenderer.createTextSprite('Welcome to Qui Browser VR', {
                fontSize: 48,
                scale: 2.0,
                distance: 3.0
            });
            welcomeSprite.position.set(0, 2.5, -3);
            scene.add(welcomeSprite);

            // ã‚¤ãƒ³ãƒ•ã‚©ãƒ†ã‚­ã‚¹ãƒˆ
            const infoSprite = textRenderer.createTextSprite('Basic VR Setup Example', {
                fontSize: 32,
                scale: 1.5,
                distance: 3.0
            });
            infoSprite.position.set(0, 2.0, -3);
            scene.add(infoSprite);

            // ã‚µãƒ³ãƒ—ãƒ«ãƒœã‚¿ãƒ³
            const button1 = ergoUI.createButton('Click Me', {
                width: 0.36,
                height: 0.12,
                onClick: () => {
                    console.log('Button 1 clicked!');
                    if (window.vrUtils) {
                        window.vrUtils.showNotification(
                            'Success',
                            'Button clicked!',
                            'success',
                            3000
                        );
                    }
                },
                color: 0x00ffff,
                hoverColor: 0x00ccff,
                textColor: '#000000'
            });

            // ãƒœã‚¿ãƒ³ã‚’ã‚¨ãƒ«ã‚´ãƒãƒŸã‚¯ã‚¹ã‚¾ãƒ¼ãƒ³ã«é…ç½®
            ergoUI.positionInViewingZone(button1, {
                zone: 'primary',
                distance: 2.0,
                horizontalAngle: -15,
                verticalAngle: -10,
                anchorMode: 'lazy-follow'
            });
            scene.add(button1);

            // ãƒœã‚¿ãƒ³ã‚’ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ç™»éŒ²
            inputOptimizer.registerInteractiveObject(button1, {
                onHover: () => console.log('Button hovered'),
                onSelect: () => {
                    console.log('Button selected via input optimizer');
                    if (window.vrUtils) {
                        window.vrUtils.showNotification(
                            'Info',
                            'Button selected!',
                            'info',
                            2000
                        );
                    }
                }
            });

            // ã‚µãƒ³ãƒ—ãƒ«ãƒœãƒƒã‚¯ã‚¹ï¼ˆè¦–ç·šã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
            const boxGeometry = new THREE.BoxGeometry(0.3, 0.3, 0.3);
            const boxMaterial = new THREE.MeshStandardMaterial({
                color: 0xff00ff,
                metalness: 0.5,
                roughness: 0.5
            });
            const box = new THREE.Mesh(boxGeometry, boxMaterial);
            box.position.set(1.0, 1.6, -2.0);
            scene.add(box);

            inputOptimizer.registerInteractiveObject(box, {
                onHover: () => {
                    box.material.color.setHex(0xff66ff);
                },
                onSelect: () => {
                    box.rotation.y += Math.PI / 4;
                    if (window.vrUtils) {
                        window.vrUtils.showNotification(
                            'Success',
                            'Box rotated!',
                            'success',
                            2000
                        );
                    }
                }
            });

            console.log('Sample content added');
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            // VRãƒœã‚¿ãƒ³
            const vrButton = document.getElementById('vr-button');
            vrButton.addEventListener('click', toggleVR);

            // VRã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            window.addEventListener('vr-session-started', (e) => {
                console.log('VR session started', e.detail);
                isVRActive = true;
                vrButton.textContent = 'VRãƒ¢ãƒ¼ãƒ‰çµ‚äº†';
                document.getElementById('status').textContent = 'ğŸ¥½';
                document.getElementById('info').style.display = 'none';
            });

            window.addEventListener('vr-session-ended', (e) => {
                console.log('VR session ended', e.detail);
                isVRActive = false;
                vrButton.textContent = 'VRãƒ¢ãƒ¼ãƒ‰èµ·å‹•';
                document.getElementById('status').textContent = 'ğŸ®';
                document.getElementById('info').style.display = 'block';
            });

            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
            window.addEventListener('vr-performance', (e) => {
                const { fps, frameTime, droppedFrames } = e.detail;
                if (fps < 72) {
                    console.warn(`Low FPS: ${fps}`);
                }
            });

            // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚º
            window.addEventListener('resize', onWindowResize);
        }

        // VRãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        async function toggleVR() {
            if (isVRActive) {
                await vrLauncher.exitVR();
            } else {
                try {
                    const supported = await vrLauncher.checkVRSupport();
                    if (supported) {
                        await vrLauncher.enterVR();
                    } else {
                        alert('ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã¯WebXRã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚');
                    }
                } catch (err) {
                    console.error('VRèµ·å‹•ã‚¨ãƒ©ãƒ¼:', err);
                    alert('VRãƒ¢ãƒ¼ãƒ‰ã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err.message);
                }
            }
        }

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚º
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
        function animate() {
            const deltaTime = clock.getDelta();

            // VRã‚·ã‚¹ãƒ†ãƒ æ›´æ–°
            ergoUI.update(deltaTime);
            comfortSystem.update(deltaTime);
            inputOptimizer.update(deltaTime);

            // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
            renderer.render(scene, camera);
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>
