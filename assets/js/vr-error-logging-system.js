class VRErrorLogger{constructor(t={}){this.options={maxLogs:t.maxLogs||1e3,enableConsole:t.enableConsole!==!1,enableRemote:t.enableRemote||!1,remoteUrl:t.remoteUrl||null,enableLocalStorage:t.enableLocalStorage!==!1,logLevel:t.logLevel||"INFO",enableMetrics:t.enableMetrics!==!1,batchSize:t.batchSize||50,flushInterval:t.flushInterval||3e4,...t},this.logs=[],this.metrics={total:0,byLevel:{},byModule:{},recent:[],timestamp:null},this.batch=[],this.flushTimer=null,this.initialized=!1}async initialize(){return console.log("[VRErrorLogger] Initializing..."),this.options.enableRemote&&this.startBatchFlush(),this.initialized=!0,console.log("[VRErrorLogger] Initialized"),!0}log(t,e,s={}){let a={timestamp:Date.now(),level:t,message:e,context:s,userAgent:navigator.userAgent,url:window.location.href};return this.logs.push(a),this.logs.length>this.options.maxLogs&&this.logs.shift(),this.updateMetrics(t),this.options.enableConsole&&this.logToConsole(t,e,s),this.options.enableLocalStorage&&this.saveToLocalStorage(a),this.options.enableRemote&&(this.batch.push(a),this.batch.length>=this.options.batchSize&&this.flush()),a}fatal(t,e={}){return this.log("FATAL",t,e)}error(t,e={}){return this.log("ERROR",t,e)}warn(t,e={}){return this.log("WARN",t,e)}info(t,e={}){return this.log("INFO",t,e)}debug(t,e={}){return this.log("DEBUG",t,e)}updateMetrics(t){this.metrics.total++,this.metrics.byLevel[t]=(this.metrics.byLevel[t]||0)+1,this.metrics.timestamp=Date.now(),this.metrics.recent.push({level:t,time:Date.now()}),this.metrics.recent.length>100&&this.metrics.recent.shift()}logToConsole(t,e,s){let a={FATAL:"color: red; font-weight: bold;",ERROR:"color: #FF5555;",WARN:"color: orange;",INFO:"color: blue;",DEBUG:"color: gray;"},i=a[t]||"",o="[VR "+t+"]";console.log("%c"+o,i,e,s)}saveToLocalStorage(t){try{let e="vr_logs_"+Math.floor(Date.now()/1e3),s=JSON.parse(localStorage.getItem(e)||"[]");s.push(t),localStorage.setItem(e,JSON.stringify(s.slice(-100)))}catch(t){}}async flush(){if(0===this.batch.length)return;let t=this.batch.splice(0,this.options.batchSize);try{await fetch(this.options.remoteUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({logs:t,metrics:this.metrics,timestamp:Date.now()})})}catch(e){console.error("[VRErrorLogger] Flush failed:",e),this.batch.unshift(...t)}}startBatchFlush(){this.flushTimer=setInterval(()=>{this.batch.length>0&&this.flush()},this.options.flushInterval)}getRecent(t=50){return this.logs.slice(-t)}getByLevel(t){return this.logs.filter(e=>e.level===t)}getSummary(){return{total:this.metrics.total,byLevel:this.metrics.byLevel,fatal:this.metrics.byLevel.FATAL||0,errors:this.metrics.byLevel.ERROR||0,warnings:this.metrics.byLevel.WARN||0,recent:this.metrics.recent.slice(-20)}}clear(){this.logs=[],this.batch=[],this.metrics={total:0,byLevel:{},byModule:{},recent:[],timestamp:null}}dispose(){this.flushTimer&&clearInterval(this.flushTimer),this.batch.length>0&&this.flush()}}class VRErrorHandler{constructor(t){this.logger=t,this.setupHandlers()}setupHandlers(){window.addEventListener("error",t=>{this.logger.error("Uncaught error",{message:t.message,filename:t.filename,error:t.error?.toString()})}),window.addEventListener("unhandledrejection",t=>{this.logger.error("Unhandled rejection",{reason:t.reason?.toString()})});let t=console.error;console.error=(...e)=>{this.logger.error("Console error",{args:e.map(t=>t?.toString?.())}),t.apply(console,e)}}}class VRPerformanceMonitor{constructor(t){this.logger=t,this.metrics={},this.marks={}}startTiming(t){this.marks[t]=performance.now()}endTiming(t,e=null){if(!this.marks[t])return this.logger.warn("Timing not started: "+t),null;let i=performance.now()-this.marks[t];return this.metrics[t]=i,e&&i>e&&this.logger.warn("Threshold exceeded: "+t),i}getMetrics(){return{...this.metrics}}clear(){this.metrics={},this.marks={}}}class VRHealthCheck{constructor(t){this.logger=t,this.checks=new Map,this.lastStatus="HEALTHY"}registerCheck(t,e,i=!1){this.checks.set(t,{fn:e,critical:i})}async runChecks(){let t={},e=!1;for(let[i,s]of this.checks){try{let a=await Promise.race([s.fn(),new Promise((t,e)=>setTimeout(()=>e(new Error("Timeout")),5e3))]);t[i]={status:a?"PASS":"FAIL",critical:s.critical},a||s.critical||(e=!0)}catch(a){t[i]={status:"ERROR",error:a.message,critical:s.critical},s.critical&&(e=!0)}}return this.lastStatus=e?"UNHEALTHY":"HEALTHY",{status:this.lastStatus,timestamp:Date.now(),checks:t}}getStatus(){return{status:this.lastStatus,timestamp:Date.now()}}}typeof window<"u"&&(window.VRErrorLogger=VRErrorLogger,window.VRErrorHandler=VRErrorHandler,window.VRPerformanceMonitor=VRPerformanceMonitor,window.VRHealthCheck=VRHealthCheck),typeof module<"u"&&module.exports&&(module.exports={VRErrorLogger:VRErrorLogger,VRErrorHandler:VRErrorHandler,VRPerformanceMonitor:VRPerformanceMonitor,VRHealthCheck:VRHealthCheck});
