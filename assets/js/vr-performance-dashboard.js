class VRPerformanceDashboard{constructor(e,t={}){this.profiler=e,this.options={position:t.position||"top-right",theme:t.theme||"dark",updateInterval:t.updateInterval||1e3,graphHistory:t.graphHistory||60,opacity:t.opacity||.85,...t},this.dashboardElement=null,this.updateTimer=null,this.isInitialized=\!1,this.isVisible=\!0,this.graphData={fps:[]},this.metrics={alerts:[]},this.eventEmitter={}}async initialize(){try{this.createDashboardUI(),this.setupEventListeners(),this.startUpdateLoop(),this.profiler&&(this.profiler.on("critical-alert",e=>this.handleAlert(e,"critical")),this.profiler.on("warning-alert",e=>this.handleAlert(e,"warning"))),this.isInitialized=\!0}catch(e){console.error("[VRPerformanceDashboard] Init failed:",e)}}createDashboardUI(){this.dashboardElement=document.createElement("div"),this.dashboardElement.id="vr-performance-dashboard",this.dashboardElement.innerHTML="<div style=\"background:rgba(20,20,30,.92);border:1px solid rgba(100,200,255,.4);border-radius:6px;padding:10px;max-width:300px;color:#d0d0ff;font-family:monospace;font-size:11px\"><div style=\"display:flex;justify-content:space-between;margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid rgba(100,200,255,.2);font-weight:700\"><div>PERF</div></div><div class=\"vr-dashboard-content\"><div class=\"vr-metrics-row\" style=\"display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-bottom:8px\"><div style=\"background:rgba(50,50,80,.5);border:1px solid rgba(100,200,255,.2);border-radius:3px;padding:6px;text-align:center\"><div style=\"font-size:9px;color:#8080c0;margin-bottom:2px\">FPS</div><div id=\"vr-fps-value\" style=\"font-size:12px;font-weight:700;color:#64ff64\">--</div></div><div style=\"background:rgba(50,50,80,.5);border:1px solid rgba(100,200,255,.2);border-radius:3px;padding:6px;text-align:center\"><div style=\"font-size:9px;color:#8080c0;margin-bottom:2px\">MEM</div><div id=\"vr-memory-value\" style=\"font-size:12px;font-weight:700;color:#64ff64\">--</div></div><div style=\"background:rgba(50,50,80,.5);border:1px solid rgba(100,200,255,.2);border-radius:3px;padding:6px;text-align:center\"><div style=\"font-size:9px;color:#8080c0;margin-bottom:2px\">GRADE</div><div id=\"vr-grade-value\" style=\"font-size:12px;font-weight:700;color:#64ff64\">--</div></div></div><div id=\"vr-modules-list\" style=\"max-height:80px;overflow-y:auto;font-size:9px;margin:6px 0\"></div></div><div style=\"padding-top:6px;border-top:1px solid rgba(100,200,255,.2);font-size:9px;color:#808080\"><div id=\"vr-footer-text\">--</div></div></div>",document.body.appendChild(this.dashboardElement)}setupEventListeners(){}startUpdateLoop(){this.updateTimer=setInterval(()=>{this.isVisible&&this.isInitialized&&this.updateDashboard()},this.options.updateInterval)}updateDashboard(){if(\!this.profiler)return;const e=this.profiler.getMetricsSnapshot();this.updateMetrics(e),this.updateModules(e),this.updateFooter(e)}updateMetrics(e){const t=e.fps.average||0;this.dashboardElement.querySelector("#vr-fps-value").textContent=t.toFixed(0);const r=(e.memory.used/1024/1024).toFixed(0);this.dashboardElement.querySelector("#vr-memory-value").textContent=r+"M";const i=this.profiler.getPerformanceGrade?..()||"A";this.dashboardElement.querySelector("#vr-grade-value").textContent=i}updateModules(e){const t=this.dashboardElement.querySelector("#vr-modules-list"),r=(e.modules||[]).sort((e,t)=>(t.avgTime||0)-(e.avgTime||0)).slice(0,3);t.innerHTML=r.map(e=>`<div style="display:flex;justify-content:space-between;padding:2px 4px;color:#b0b0ff"><span>${e.id}</span><span>${(e.avgTime||0).toFixed(1)}ms</span></div>`).join("")}handleAlert(e,t){this.metrics.alerts.unshift({...e,severity:t}),this.metrics.alerts.length>10&&this.metrics.alerts.pop()}updateFooter(e){const t=this.dashboardElement.querySelector("#vr-footer-text"),r=new Date().toLocaleTimeString().split(" ")[0];t.textContent=r}toggleVisibility(){this.isVisible=\!this.isVisible,this.dashboardElement.style.display=this.isVisible?"block":"none"}on(e,t){this.eventEmitter[e]||(this.eventEmitter[e]=[]),this.eventEmitter[e].push(t)}emit(e,t){this.eventEmitter[e]&&this.eventEmitter[e].forEach(e=>e(t))}dispose(){this.updateTimer&&clearInterval(this.updateTimer),this.dashboardElement&&(this.dashboardElement.remove(),this.dashboardElement=null)}}if("undefined"\!=typeof module&&module.exports)module.exports=VRPerformanceDashboard;if("undefined"\!=typeof window)window.VRPerformanceDashboard=VRPerformanceDashboard;
