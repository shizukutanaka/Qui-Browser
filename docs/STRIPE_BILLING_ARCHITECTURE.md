# Stripe Billing Architecture for Qui Browser VR
## 課金システム設計書

**Version:** 1.0.0
**Date:** 2025-10-25
**Status:** Production Ready

---

## 🎯 課金モデルの設計

### ビジネス目標

1. **無料ユーザーの獲得** - 基本機能を無料提供してユーザーベース拡大
2. **プレミアム機能の収益化** - 高度な機能を有料化
3. **エンタープライズ対応** - 法人向けプランで大口収益確保
4. **段階的な課金** - 使用量に応じた柔軟な課金

### 料金プラン構成

#### 1. **Free Tier (無料プラン)**
**月額:** ¥0 / $0

**含まれる機能:**
- ✅ 基本的なVRブラウジング (3Dタブマネージャー、ブックマーク)
- ✅ ハンドトラッキング (基本ジェスチャー: ピンチ、グラブ、ポイント)
- ✅ 音声コマンド (日本語、基本コマンドのみ)
- ✅ 環境カスタマイズ (6プリセット)
- ✅ テキスト入力 (仮想キーボードのみ)
- ✅ 動画視聴 (1080p、30fps)
- ✅ パフォーマンス最適化 (基本レベル)

**制限:**
- ❌ Foveated Rendering (無効)
- ❌ 高度なジェスチャー (15ジェスチャー → 3ジェスチャーのみ)
- ❌ 4K/8K動画
- ❌ AI機能
- ❌ クラウド同期
- ❌ マルチプレイヤー
- ⏱️ セッション時間: 60分/日

#### 2. **Premium Tier (プレミアムプラン)**
**月額:** ¥980 / $9.99
**年額:** ¥9,800 / $99.99 (2ヶ月分お得)

**Freeの全機能 + 以下:**
- ✅ **Foveated Rendering** (FFR: 25-50% GPU削減)
- ✅ **高度なハンドジェスチャー** (15種類すべて)
- ✅ **Swypeテキスト入力** (2-3倍高速)
- ✅ **4K動画視聴** (60fps)
- ✅ **高度な人間工学機能** (20-20-20ルール、瞬き監視)
- ✅ **クラウド同期** (ブックマーク、設定、履歴)
- ✅ **広告非表示**
- ✅ **優先サポート**
- ⏱️ セッション時間: 無制限

**価格設定理由:**
- Netflix ($15.49), Spotify ($9.99) と同等の価格帯
- VR特化機能による差別化
- 年間プランで継続率向上 (2ヶ月無料で17%割引)

#### 3. **Pro Tier (プロプラン) - Quest Pro ユーザー向け**
**月額:** ¥1,980 / $19.99
**年額:** ¥19,800 / $199.99 (2ヶ月分お得)

**Premiumの全機能 + 以下:**
- ✅ **Eye-Tracked Foveated Rendering (ETFR)** (36-52% GPU削減)
- ✅ **視線追跡キーボード** (12 WPM ハンズフリー)
- ✅ **8K動画視聴** (30fps)
- ✅ **AI機能フル解放:**
  - AI画面読み上げ (WCAG AAA)
  - AIレコメンデーション
  - AI要約機能
- ✅ **マルチプレイヤーVR** (最大10人)
- ✅ **高度なアクセシビリティ** (全プロファイル)
- ✅ **プライオリティレンダリング** (最高品質)
- ✅ **専用サポート** (24時間以内返信)

**対象ユーザー:**
- Meta Quest Pro所有者
- プロフェッショナル用途 (デザイナー、開発者、リモートワーク)
- 最高のパフォーマンスを求めるユーザー

#### 4. **Enterprise Tier (エンタープライズプラン)**
**月額:** ¥50,000〜 / $499〜 (要問い合わせ)

**Proの全機能 + 以下:**
- ✅ **カスタムブランディング** (ロゴ、色、環境)
- ✅ **SSO統合** (Azure AD, Okta, Google Workspace)
- ✅ **チーム管理** (ユーザー管理、権限設定)
- ✅ **使用状況分析** (ダッシュボード、レポート)
- ✅ **専用インスタンス** (オンプレミス対応可能)
- ✅ **SLA保証** (99.9% uptime)
- ✅ **優先開発** (機能リクエスト優先対応)
- ✅ **専任サポート** (営業時間内即時対応)
- ✅ **セキュリティ監査** (年次セキュリティレポート)

**対象顧客:**
- 企業・法人 (50人以上)
- 教育機関
- 政府機関

---

## 💰 使用量ベース課金 (Add-ons)

### 1. **追加ストレージ**
**基本:** 5GB (Premium), 50GB (Pro), 500GB (Enterprise)
**追加:** ¥100/月 per 10GB ($0.99/month per 10GB)

### 2. **AI機能使用量**
**基本:** 100リクエスト/月 (Pro以上)
**追加:** ¥500/月 per 500リクエスト ($4.99/month per 500 requests)

### 3. **マルチプレイヤーセッション時間**
**基本:** 10時間/月 (Pro以上)
**追加:** ¥300/月 per 10時間 ($2.99/month per 10 hours)

### 4. **カスタム環境作成**
**1環境:** ¥1,500 ($14.99) - 買い切り

---

## 🏗️ 技術アーキテクチャ

### Stripe製品の使用

#### 1. **Stripe Checkout**
- 決済ページホスティング (セキュア、PCI DSS準拠)
- 多通貨対応 (USD, JPY, EUR, GBP等)
- 複数の決済手段 (クレジットカード、デビットカード、Apple Pay、Google Pay)

#### 2. **Stripe Billing (Subscriptions)**
- サブスクリプション管理
- 自動請求
- プラン変更 (アップグレード/ダウングレード)
- 日割り計算
- トライアル期間 (14日間無料)

#### 3. **Stripe Customer Portal**
- セルフサービス管理
- 請求書ダウンロード
- 支払い方法更新
- サブスクリプションキャンセル

#### 4. **Stripe Webhooks**
- リアルタイムイベント処理
- サブスクリプション更新通知
- 支払い成功/失敗
- 顧客ステータス変更

#### 5. **Stripe Metered Billing**
- 使用量ベース課金 (ストレージ、AIリクエスト等)
- リアルタイム使用量レポート
- 月次集計と請求

---

## 🔄 ユーザーフロー

### 新規ユーザー登録フロー

```
1. VRブラウザ起動 (Free Tierで利用開始)
   ↓
2. Premium機能を試す (14日間無料トライアル)
   ↓
3. Stripe Checkoutで支払い情報入力
   ↓
4. サブスクリプション開始
   ↓
5. Premium機能アンロック
```

### プラン変更フロー

```
1. VR内の設定メニュー → "サブスクリプション管理"
   ↓
2. Stripe Customer Portal へリダイレクト
   ↓
3. プラン変更選択 (即座反映 or 次回更新時)
   ↓
4. 確認 → 変更完了
   ↓
5. VRブラウザに反映 (Webhook経由)
```

### キャンセルフロー

```
1. Customer Portal → "サブスクリプションをキャンセル"
   ↓
2. キャンセル理由選択 (フィードバック収集)
   ↓
3. オファー提示 (1ヶ月50%オフ等)
   ↓
4. キャンセル確定 or 継続
   ↓
5. 期間終了まで利用可能 → Free Tierにダウングレード
```

---

## 🛡️ セキュリティ設計

### 1. **PCI DSS準拠**
- カード情報は一切サーバーに保存しない
- Stripe Checkoutで全決済処理
- Stripe.js (Elements) 使用でトークン化

### 2. **認証・認可**
- JWT (JSON Web Token) でユーザー認証
- サブスクリプションステータスをJWTに含める
- サーバーサイドで常に検証

### 3. **Webhook署名検証**
- Stripe署名ヘッダー検証 (HMAC SHA256)
- タイムスタンプ検証 (リプレイ攻撃防止)
- ホワイトリストIPからのみ受信

### 4. **データ暗号化**
- データベース暗号化 (AES-256)
- HTTPS通信 (TLS 1.3)
- 顧客IDの難読化

---

## 📊 分析・メトリクス

### ビジネスKPI

1. **MRR (Monthly Recurring Revenue)** - 月次定期収益
2. **ARR (Annual Recurring Revenue)** - 年次定期収益
3. **Churn Rate** - 解約率 (目標: <5%)
4. **ARPU (Average Revenue Per User)** - ユーザーあたり平均収益
5. **LTV (Lifetime Value)** - 顧客生涯価値
6. **CAC (Customer Acquisition Cost)** - 顧客獲得コスト
7. **Conversion Rate** - Free → Premium 転換率 (目標: 5-10%)

### 技術メトリクス

1. **Checkout完了率** (目標: >80%)
2. **決済成功率** (目標: >95%)
3. **Webhook処理遅延** (目標: <500ms)
4. **API応答時間** (目標: <200ms)

---

## 🌍 国際化対応

### 通貨対応

- **日本円 (JPY)** - 日本市場
- **米ドル (USD)** - 北米・グローバル
- **ユーロ (EUR)** - ヨーロッパ
- **英ポンド (GBP)** - イギリス
- **韓国ウォン (KRW)** - 韓国市場

### 価格ローカライズ

| プラン | 日本 (JPY) | 米国 (USD) | EU (EUR) | 英国 (GBP) |
|--------|-----------|-----------|----------|-----------|
| Premium (月) | ¥980 | $9.99 | €9.99 | £8.99 |
| Premium (年) | ¥9,800 | $99.99 | €99.99 | £89.99 |
| Pro (月) | ¥1,980 | $19.99 | €19.99 | £17.99 |
| Pro (年) | ¥19,800 | $199.99 | €199.99 | £179.99 |

### 税金対応

- **日本:** 消費税 10% (自動加算)
- **EU:** VAT (国によって異なる、Stripeが自動計算)
- **米国:** 州税 (該当州のみ)

---

## 📱 VR-Native UI/UX

### 1. **VR内決済フロー**

```javascript
// VR空間内での3Dモーダル表示
showSubscriptionModal() {
  // 3D空間に浮かぶ決済UI
  - プラン比較カード (3Dカード形式)
  - 機能一覧 (チェックマーク付き)
  - 価格表示 (大きな文字)
  - "無料トライアル開始" ボタン (3Dボタン、ハンドジェスチャーで選択)
}
```

### 2. **支払い確認通知**

```
VR空間内通知:
「✅ Premiumプランへようこそ！
 すべての機能がアンロックされました」

(3D通知が3秒間表示、自動的にフェードアウト)
```

### 3. **サブスクリプション管理UI**

```
VR Settings → Subscription:
- 現在のプラン表示 (Premium/Pro バッジ)
- 次回更新日
- 使用量メーター (ストレージ、AI使用量等)
- "プラン変更" ボタン
- "請求履歴" ボタン
- "キャンセル" ボタン
```

---

## 🚀 実装フェーズ

### Phase 1: 基本課金システム (2週間)
- ✅ Stripe Checkout統合
- ✅ サブスクリプション作成 (Premium, Pro)
- ✅ Webhook処理 (基本イベント)
- ✅ データベーススキーマ設計

### Phase 2: VR-Native UI (1週間)
- ✅ VR内決済モーダル
- ✅ プラン比較UI
- ✅ サブスクリプション管理画面

### Phase 3: 高度な機能 (2週間)
- ✅ 使用量ベース課金 (Metered Billing)
- ✅ Customer Portal統合
- ✅ アップグレード/ダウングレード

### Phase 4: エンタープライズ (3週間)
- ✅ SSO統合
- ✅ チーム管理
- ✅ カスタム契約

---

## 💡 収益予測

### 保守的シナリオ (1年後)

| ユーザー層 | ユーザー数 | ARPU (月) | MRR | ARR |
|-----------|----------|----------|-----|-----|
| Free | 10,000 | ¥0 | ¥0 | ¥0 |
| Premium | 500 (5%) | ¥980 | ¥490,000 | ¥5,880,000 |
| Pro | 50 (0.5%) | ¥1,980 | ¥99,000 | ¥1,188,000 |
| Enterprise | 2 | ¥100,000 | ¥200,000 | ¥2,400,000 |
| **合計** | **10,552** | **¥75** | **¥789,000** | **¥9,468,000** |

### 楽観的シナリオ (1年後)

| ユーザー層 | ユーザー数 | ARPU (月) | MRR | ARR |
|-----------|----------|----------|-----|-----|
| Free | 50,000 | ¥0 | ¥0 | ¥0 |
| Premium | 5,000 (10%) | ¥980 | ¥4,900,000 | ¥58,800,000 |
| Pro | 500 (1%) | ¥1,980 | ¥990,000 | ¥11,880,000 |
| Enterprise | 10 | ¥200,000 | ¥2,000,000 | ¥24,000,000 |
| **合計** | **55,510** | **¥142** | **¥7,890,000** | **¥94,680,000** |

---

## ✅ 成功要因

1. **無料プランの魅力** - 基本機能が充実していてユーザーが集まる
2. **明確な価値提案** - Premiumで何が得られるか明確
3. **スムーズなアップグレード** - VR内で簡単に課金可能
4. **継続的な価値提供** - 新機能を定期的にリリース
5. **優れたサポート** - ユーザーの問題を迅速に解決
6. **データドリブン改善** - メトリクス分析による継続的改善

---

**ドキュメントバージョン:** 1.0.0
**最終更新:** 2025-10-25
**作成者:** Qui Browser VR Team
