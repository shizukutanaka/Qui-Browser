# Базовая безопасность (Русский)

## Модель угроз

- **Поверхность сервера**: `server-lightweight.js` предоставляет REST API и
  статические файлы.
- **Данные в хранении**: метаданные расширений (`data/extensions.json`), сессии
  браузера и реестр подписок (`data/subscriptions.json`).
- **Данные в транзите**: запросы VR-клиента и вебхуки Stripe.

## Чек-лист усиления

- **TLS-терминация**: развёртывайте сервер за HTTPS-прокси или балансировщиком
  нагрузки.
- **Проверка заголовка Host**: задайте `ALLOWED_HOSTS` в `.env`;
  `validateHostHeader()` блокирует неразрешённые хосты.
- **Строгий CORS**: `parseAllowedOrigins()` поддерживает белый список
  источников.
- **Ограничение частоты**: `checkRateLimit()` со скользящим окном ограничивает
  злоупотребления.
- **Безопасная статика**: `serveStaticFile()` нормализует пути и проверяет
  символические ссылки.
- **Контролируемая компрессия**: `utils/compression.js` ограничивает сжатие
  допустимыми MIME-типами, уменьшая риск BREACH.

## Управление ключами Stripe

- Храните `STRIPE_SECRET_KEY` и `STRIPE_WEBHOOK_SECRET` в менеджере секретов.
- Регулярно ротируйте ключи и обновляйте переменные CI/CD.
- Принимайте вебхуки только по HTTPS и отслеживайте ошибки проверки подписи.

## Реагирование на инциденты

1. Блокируйте трафик или отзывайте ключи при подозрении на компрометацию.
2. Анализируйте логи в `logs/` и события в панели Stripe.
3. При необходимости восстанавливайте из `backups/` и запускайте `npm test` для
   проверки.
4. Применяйте исправления, повторно развёртывайте и информируйте
   заинтересованные стороны, фиксируя выводы.

## Соответствие требованиям

- Определяйте сроки хранения истории VR и подписочных данных.
- Ведите учёт согласий по GDPR/CCPA.
- Выполняйте `npm run security:scan` при каждом слиянии и сохраняйте результаты.
