# أساسيات الأمان (العربية)

## نموذج التهديدات

- **سطح الخادم**: ملف `server-lightweight.js` يعرّض واجهات REST والملفات
  الثابتة.
- **البيانات المخزنة**: بيانات الامتدادات (`data/extensions.json`)، جلسات
  المتصفح، وسجل الاشتراكات (`data/subscriptions.json`).
- **البيانات المنقولة**: طلبات متصفح الواقع الافتراضي وتنبيهات Webhook من
  Stripe.

## قائمة التعزيز الأمني

- **إنهاء TLS**: تشغيل الخادم خلف HTTPS عبر بروكسي عكسي أو موازن حمل.
- **التحقق من الرأس Host**: تعيين `ALLOWED_HOSTS` في `.env` وترك وظيفة
  `validateHostHeader()` تمنع المجالات غير المصرح بها.
- **سياسة CORS مقيدة**: `parseAllowedOrigins()` يحافظ على قائمة بيضاء للأصول
  المسموح بها.
- **تحديد المعدل**: وظيفة `checkRateLimit()` بنظام النافذة المنزلقة تمنع إساءة
  الاستخدام.
- **تقديم ملفات ثابتة آمن**: `serveStaticFile()` يقوم بتطبيع المسارات والتحقق من
  الروابط الرمزية.
- **سياسة الضغط**: `utils/compression.js` يقيّد أنواع MIME القابلة للضغط لتقليل
  مخاطر هجمات BREACH.

## إدارة مفاتيح Stripe

- حفظ `STRIPE_SECRET_KEY` و `STRIPE_WEBHOOK_SECRET` في نظام إدارة أسرار آمن.
- تدوير المفاتيح دوريًا وتحديث متغيرات CI/CD.
- قبول Webhooks عبر HTTPS فقط ومراقبة الإخفاق في التحقق من التوقيع.

## الاستجابة للحوادث

1. إيقاف حركة المرور أو إبطال المفاتيح عند الاشتباه في اختراق.
2. فحص سجلات `logs/` وأحداث لوحة تحكم Stripe.
3. استعادة البيانات من `backups/` عند الحاجة وتشغيل `npm test` للتحقق من
   السلامة.
4. تطبيق التصحيحات، إعادة النشر، وإخطار أصحاب المصلحة وتوثيق الدروس المستفادة.

## الامتثال

- توثيق سياسات الاحتفاظ بسجل التصفح VR وبيانات الاشتراكات.
- الحفاظ على سجلات الموافقة وفقًا لقوانين الخصوصية مثل GDPR و CCPA.
- تشغيل `npm run security:scan` مع كل عملية دمج والاحتفاظ بالنتائج.
